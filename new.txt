from django.template.loader import render_to_string
from weasyprint import HTML
from django.http import HttpResponse

def download_preview_as_pdf(request, intake_form_id):
    # Render preview_form.html with necessary context data
    html_string = render_to_string('preview_form.html', {'form_id': intake_form_id})

    # Create PDF from HTML string
    pdf_file = HTML(string=html_string).write_pdf()

    # Prepare the response as a PDF file download
    response = HttpResponse(pdf_file, content_type='application/pdf')
    response['Content-Disposition'] = f'attachment; filename="Form_{intake_form_id}.pdf"'
    
    return response
