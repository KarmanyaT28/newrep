<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Forms - OPTUM</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f7fc;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: center;
        }
        th {
            background-color: #007bff;
            color: white;
        }
        button {
            padding: 5px 10px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        button:hover {
            background-color: #218838;
        }
        h3 {
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="{% url 'dashboard' %}">Dashboard</a>
        <h1>Forms</h1>

        <table>
            
                {% for form in forms %}
                <thead>
                    <tr>Form ID : {{ form.0 }}, Form Data: {{ form.1 }}, Created At: {{ form.2 }}, Status: {{ form.3 }}
                    
                        
                        <a href="{% url 'preview_form' form.0 %}">Preview</a><br><br><br>

                        {% if form.3 == 'Submitted' %}
                        <form action="{% url 'update_form_status' form.0 %}" method="post">
                            {% csrf_token %}

                            <button type="submit">Move to Pending Approval</button><br>
                        </form>
                        
                        {% endif %}

                        {% if form.3 == 'In Progress' %}
                        <form action="{% url 'submit_form' form.0 %}" method="post">
                            {% csrf_token %}

                            <button type="submit">Submit</button><br>
                        </form>
                        
                        {% endif %}

                        {% if form.3 == 'Pending Approval' %}
                        <form action="{% url 'update_form_status_approved' form.0 %}" method="post">
                            {% csrf_token %}

                            <button type="submit">Approved</button><br>
                        </form>
                        
                        {% endif %}

                        {% if form.3 == 'Approved' %}
                        <form action="{% url 'update_form_status_mail' form.0 %}" method="post">
                            {% csrf_token %}

                            <button type="submit">Completed & MAIL SENT</button><br>
                        </form>
                        
                        {% endif %}
                    </tr>
                    {% empty %}
                    <tr>You have not created any forms</tr>
                </thead>
                {% endfor %}

            

                </table>

    </div>
</body>
</html>











def download_form(request, intake_form_id):
    # SQL query to fetch form data
    query = """
    SELECT * FROM intake_form
    WHERE id = %s
    """
    
    with connection.cursor() as cursor:
        cursor.execute(query, [intake_form_id])
        form_data = cursor.fetchone()
    
    if not form_data:
        return HttpResponse("Form not found.", status=404)

    # Create a Word document
    doc = Document()
    doc.add_heading('Intake Form', 0)

    # Assuming the form_data has the required fields in the correct order
    doc.add_paragraph(f"Form ID: {form_data[0]}")
    doc.add_paragraph(f"List of Applications: {form_data[1]}")
    doc.add_paragraph(f"Application ID: {form_data[2]}")
    # Add other fields similarly

    # Prepare the document for download
    buffer = io.BytesIO()
    doc.save(buffer)
    buffer.seek(0)

    response = HttpResponse(buffer, content_type='application/vnd.openxmlformats-officedocument.wordprocessingml.document')
    response['Content-Disposition'] = f'attachment; filename=Intake_Form_{intake_form_id}.docx'

    return response
